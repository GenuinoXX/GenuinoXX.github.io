<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Baidu</title>
    <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=1Vkcxd0Q6iomR9TI8zNfzhwXWdeBYAd2"></script>
</head>
<style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    #map {
        width: 100%;
        height: 500px;
    }
</style>
<body>
    <div id="map"></div>
    <script>
      var map = new BMap.Map("map", {
          enableMapClick: false
      });

      const params = new URLSearchParams(window.location.search);
      const encodedPois = params.get("pois");
      let pois = [];

      try {
          if (encodedPois) {
              const jsonStr = atob(decodeURIComponent(encodedPois));
              pois = JSON.parse(jsonStr);
          }
      } catch (e) {
          console.error("Error al decodificar los POIs:", e);
      }

      const center = pois[0] ? new BMap.Point(pois[0].lng, pois[0].lat) : new BMap.Point(116.404, 39.915);
      map.centerAndZoom(center, 8);
      map.enableAutoResize();
      map.enableScrollWheelZoom();
      map.enableInertialDragging();
      map.enableContinuousZoom();
      map.addControl(new BMap.NavigationControl());
      map.addControl(new BMap.ScaleControl());

      pois.forEach(poi => {
          const poiPoint = new BMap.Point(poi.lng, poi.lat);
          const icon = new BMap.Icon(poi.icon, new BMap.Size(32, 32));
          const marker = new BMap.Marker(poiPoint, { icon });
          marker.setTitle(poi.name);
          map.addOverlay(marker);

          const toggle = () => {
              if (map.getZoom() < poi.zoom) {
                  marker.hide();
              } else {
                  marker.show();
              }
          };

          toggle();
          map.addEventListener("zoomend", toggle);
      });
    </script>    
</body>
</html>